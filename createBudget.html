<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Exchange Proposal Generator</title>
<style>
    body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
    h1, h2 { color: #333; }
    label { display: block; margin: 10px 0 5px; font-weight: bold; }
    input[type="number"] { width: 60px; padding: 5px; margin-bottom: 15px; }
    hr { margin: 30px 0; }
    .form-container { max-width: 400px; }
    .proposal { margin-top: 30px; padding: 20px; border: 1px solid #ccc; border-radius: 5px; background: #fafafa; }
    .proposal h2 { margin-top: 0; }
    .proposal table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    .proposal table, .proposal th, .proposal td { border: 1px solid #999; }
    .proposal th, .proposal td { padding: 8px; text-align: left; }
</style>
</head>
<body>

<h1>Data Exchange Proposal Generator</h1>

<p>Set the number of organizations (o) and formats (f) below. The proposal will update automatically.</p>

<hr>

<div class="form-container">
    <form id="proposalParmsForm">
        <button type="submit">Update URL & Proposal</button>
        <template id="proposalParmInput">
            <label for="parm-">:</label>
            <input type="number" id="parm-" min="1" required>
        </template>
    </form>
</div>

<div class="proposal" id="proposalContent">
    <!-- Generated proposal will appear here -->
</div>

<script>
  const ParameterList = [
    { name: 'nOrgs', defolt: 5, prompt: "Number of Organizations" },
    { name: 'nFormats', defolt: 3, prompt: "Number of Formats" },
    { name: 'salary', defolt: 70000, prompt: "FTE billing €/year" },
    { name: 'hotelNight', defolt: 130, prompt: "Average hotel cost €/night" },
  ];
  const CurrentParms = {};
  
  const form = document.getElementById("proposalParmsForm");
  const submit = form.querySelectorAll('submit');
  const template = document.getElementById("proposalParmInput");
  const clones = ParameterList.map(parm => {
    const searchValue = parseInt(new URLSearchParams(window.location.search).get('salary')) || parm.defolt;
    CurrentParms[parm.name] = searchValue;

    const id = "parm-" + parm.name;
    const clone = template.content.cloneNode(true);

    const label = clone.querySelector("label");
    label.textContent = parm.prompt;
    label.setAttribute("for", id);

    const input = clone.querySelector("input");
    label.setAttribute("id", id);
    input.value = searchValue;
    input.dataset.parm = parm;
    input.addEventListener('input', function() {
      const params = new URLSearchParams(window.location.search);
      params.set(parm.name, input.value);
      history.replaceState(null, '', window.location.pathname + '?' + params.toString());

      const updatedValue = input.value;
      CurrentParms[parm.name] = updatedValue;
      generateProposal(CurrentParms);
    });

    form.appendChild(clone);
  });
  
  // Constants
  
  function initForm() {
    generateProposal(CurrentParms);
  }
  
  function generateProposal(parms) {
    const {nOrgs, nFormats, salary, hotelNight} = parms;

    const workDaysPerYear = 220;
    const dailyRate = salary / workDaysPerYear;
    const travelCostPerMeeting = 400 + (3*hotelNight) + (3*60); // travel + hotel + per diem

    const meetings = 2*nOrgs + 3*nFormats;
    const travelCost = meetings * travelCostPerMeeting;
    const meetingStaffDays = meetings * 2;
    const meetingStaffCost = meetingStaffDays * dailyRate;
    
    const infrastructureFTE = 3; // months
    const uiFTE = 3; // months
    const formatEngineeringFTE = 2*nFormats; // 2 months per format
    const formatUIFTE = 1*nFormats; // 1 month per format
    
    const engineeringCost = (infrastructureFTE + uiFTE + formatEngineeringFTE + formatUIFTE) * (salary/12);
    
    const totalCost = travelCost + meetingStaffCost + engineeringCost;
    
    const proposalHTML = `
            <h2>Proposal: Establishment of a Data Exchange Standard</h2>

            <h3>1. Executive Summary</h3>
            <p>This proposal outlines the estimated resources, time, and costs required to establish a data exchange standard across <strong>${nOrgs}</strong> organizations and <strong>${nFormats}</strong> target formats. The project includes coordination meetings, infrastructure development, user interface (UI) work, and format-specific engineering.</p>

            <h3>2. Scope of Work</h3>
            <ul>
                <li>Stakeholder engagement: 2 meetings per organization and 3 meetings per format.</li>
                <li>Travel & subsistence for project team members attending stakeholder sessions.</li>
                <li>Infrastructure engineering: Core back-end and data exchange infrastructure.</li>
                <li>User Interface (UI) development: Reference implementation for interacting with the data exchange.</li>
                <li>Format-specific engineering and UI adjustments.</li>
            </ul>

            <h3>3. Resource Requirements</h3>
            <ul>
                <li>Infrastructure Engineering: 3 months FTE</li>
                <li>UI Engineering (core): 3 months FTE</li>
                <li>Format Engineering: 2 months/format × ${nFormats} formats = ${formatEngineeringFTE} months FTE</li>
                <li>Format-specific UI: 1 month/format × ${nFormats} formats = ${formatUIFTE} months FTE</li>
                <li>Meetings/Coordination: ${meetingStaffDays} staff-days</li>
            </ul>

            <h3>4. Cost Estimate</h3>
            <table>
                <tr><th>Component</th><th>Cost (€)</th></tr>
                <tr><td>Travel & subsistence (${meetings} meetings)</td><td>${travelCost.toFixed(0)}</td></tr>
                <tr><td>Staff time – meetings (${meetingStaffDays} days)</td><td>${meetingStaffCost.toFixed(0)}</td></tr>
                <tr><td>Engineering & UI (FTEs)</td><td>${engineeringCost.toFixed(0)}</td></tr>
                <tr><th>Total Project Estimate</th><th>${totalCost.toFixed(0)}</th></tr>
            </table>

            <h3>5. Assumptions & Exclusions</h3>
            <ul>
                <li>Billing rate: ${salary} €/year (~${dailyRate.toFixed(0)} €/day).</li>
                <li>Hotel: ${hotelNight} €/night, 3 nights per meeting.</li>
                <li>Per diem: 60 €/day, 3 days per meeting.</li>
                <li>Travel: 400 €/meeting within Europe.</li>
            </ul>
        `;
    document.getElementById('proposalContent').innerHTML = proposalHTML;
  }
  
  window.addEventListener('load', initForm);
</script>

</body>
</html>
